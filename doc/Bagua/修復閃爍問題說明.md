# 修復頁面模式閃爍問題

## 🐛 問題描述
原先的實現會導致頁面載入時出現閃爍效果：
1. 頁面首先顯示預設的搜尋模式
2. 然後在 onMounted 中載入保存的狀態
3. 如果保存的是占卜模式，會看到從搜尋模式跳轉到占卜模式的閃爍

## ✅ 解決方案
修改為在 ref 初始化時就直接使用正確的狀態：

### 新的實現方式
```javascript
// 立即載入保存的狀態（避免閃爍效果）
const getInitialPageMode = () => {
  if (typeof window !== 'undefined') {
    const saved = localStorage.getItem('easternDivination_pageMode')
    return (saved && ['search', 'divination'].includes(saved)) ? saved : 'search'
  }
  return 'search'
}

const getInitialDivinationMode = () => {
  if (typeof window !== 'undefined') {
    const saved = localStorage.getItem('easternDivination_divinationMode')
    return (saved && ['yinyang', 'coins'].includes(saved)) ? saved : 'yinyang'
  }
  return 'yinyang'
}

// 直接使用正確的初始值
const pageMode = ref(getInitialPageMode())
const divinationMode = ref(getInitialDivinationMode())
```

## 🔧 主要改動

### ✅ 新增功能
- `getInitialPageMode()`: 立即讀取頁面模式
- `getInitialDivinationMode()`: 立即讀取占卜模式
- 加入 `typeof window !== 'undefined'` 檢查（SSR 兼容）

### 🗑️ 移除內容
- `loadSavedStates()` 函數（不再需要）
- `onMounted` 生命週期鉤子中的狀態載入
- `onMounted` 從導入中移除
- 控制台日誌輸出（按用戶要求）

### 📝 保留功能
- `saveState()` 函數：用於保存狀態變更
- `togglePageMode()` 和 `toggleDivinationMode()`: 仍然會保存狀態

## 🎯 效果

### 修改前
```
載入頁面 → 顯示搜尋模式 → onMounted 執行 → 跳轉到占卜模式 ❌ 閃爍
```

### 修改後  
```
載入頁面 → 直接顯示正確的占卜模式 ✅ 無閃爍
```

## ⚡ 性能優化
- 減少了不必要的狀態變更
- 移除了 onMounted 生命週期
- 直接在初始化時設置正確狀態

## 🛡️ 兼容性
- 加入了 SSR 檢查 `typeof window !== 'undefined'`
- 確保在服務端渲染環境中不會出錯
- 保持原有的輸入驗證邏輯

現在用戶回到網頁時，會直接看到上次選擇的模式，沒有任何閃爍效果！🎉
