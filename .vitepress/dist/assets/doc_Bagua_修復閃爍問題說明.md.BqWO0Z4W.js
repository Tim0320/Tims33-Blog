import{_ as s,c as a,o as n,ag as l}from"./chunks/framework.DJGjAsO8.js";const E=JSON.parse('{"title":"修復頁面模式閃爍問題","description":"","frontmatter":{},"headers":[],"relativePath":"doc/Bagua/修復閃爍問題說明.md","filePath":"doc/Bagua/修復閃爍問題說明.md","lastUpdated":null}'),h={name:"doc/Bagua/修復閃爍問題說明.md"};function t(e,i,k,p,d,r){return n(),a("div",null,i[0]||(i[0]=[l(`<h1 id="修復頁面模式閃爍問題" tabindex="-1">修復頁面模式閃爍問題 <a class="header-anchor" href="#修復頁面模式閃爍問題" aria-label="Permalink to &quot;修復頁面模式閃爍問題&quot;">​</a></h1><h2 id="🐛-問題描述" tabindex="-1">🐛 問題描述 <a class="header-anchor" href="#🐛-問題描述" aria-label="Permalink to &quot;🐛 問題描述&quot;">​</a></h2><p>原先的實現會導致頁面載入時出現閃爍效果：</p><ol><li>頁面首先顯示預設的搜尋模式</li><li>然後在 onMounted 中載入保存的狀態</li><li>如果保存的是占卜模式，會看到從搜尋模式跳轉到占卜模式的閃爍</li></ol><h2 id="✅-解決方案" tabindex="-1">✅ 解決方案 <a class="header-anchor" href="#✅-解決方案" aria-label="Permalink to &quot;✅ 解決方案&quot;">​</a></h2><p>修改為在 ref 初始化時就直接使用正確的狀態：</p><h3 id="新的實現方式" tabindex="-1">新的實現方式 <a class="header-anchor" href="#新的實現方式" aria-label="Permalink to &quot;新的實現方式&quot;">​</a></h3><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 立即載入保存的狀態（避免閃爍效果）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getInitialPageMode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> window </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;undefined&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> saved</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;easternDivination_pageMode&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (saved </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;search&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;divination&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(saved)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> saved </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;search&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;search&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getInitialDivinationMode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">typeof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> window </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;undefined&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> saved</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> localStorage.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;easternDivination_divinationMode&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (saved </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;yinyang&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;coins&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">].</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(saved)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> saved </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;yinyang&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;yinyang&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 直接使用正確的初始值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> pageMode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getInitialPageMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> divinationMode</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ref</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getInitialDivinationMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span></code></pre></div><h2 id="🔧-主要改動" tabindex="-1">🔧 主要改動 <a class="header-anchor" href="#🔧-主要改動" aria-label="Permalink to &quot;🔧 主要改動&quot;">​</a></h2><h3 id="✅-新增功能" tabindex="-1">✅ 新增功能 <a class="header-anchor" href="#✅-新增功能" aria-label="Permalink to &quot;✅ 新增功能&quot;">​</a></h3><ul><li><code>getInitialPageMode()</code>: 立即讀取頁面模式</li><li><code>getInitialDivinationMode()</code>: 立即讀取占卜模式</li><li>加入 <code>typeof window !== &#39;undefined&#39;</code> 檢查（SSR 兼容）</li></ul><h3 id="🗑️-移除內容" tabindex="-1">🗑️ 移除內容 <a class="header-anchor" href="#🗑️-移除內容" aria-label="Permalink to &quot;🗑️ 移除內容&quot;">​</a></h3><ul><li><code>loadSavedStates()</code> 函數（不再需要）</li><li><code>onMounted</code> 生命週期鉤子中的狀態載入</li><li><code>onMounted</code> 從導入中移除</li><li>控制台日誌輸出（按用戶要求）</li></ul><h3 id="📝-保留功能" tabindex="-1">📝 保留功能 <a class="header-anchor" href="#📝-保留功能" aria-label="Permalink to &quot;📝 保留功能&quot;">​</a></h3><ul><li><code>saveState()</code> 函數：用於保存狀態變更</li><li><code>togglePageMode()</code> 和 <code>toggleDivinationMode()</code>: 仍然會保存狀態</li></ul><h2 id="🎯-效果" tabindex="-1">🎯 效果 <a class="header-anchor" href="#🎯-效果" aria-label="Permalink to &quot;🎯 效果&quot;">​</a></h2><h3 id="修改前" tabindex="-1">修改前 <a class="header-anchor" href="#修改前" aria-label="Permalink to &quot;修改前&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>載入頁面 → 顯示搜尋模式 → onMounted 執行 → 跳轉到占卜模式 ❌ 閃爍</span></span></code></pre></div><h3 id="修改後" tabindex="-1">修改後 <a class="header-anchor" href="#修改後" aria-label="Permalink to &quot;修改後&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>載入頁面 → 直接顯示正確的占卜模式 ✅ 無閃爍</span></span></code></pre></div><h2 id="⚡-性能優化" tabindex="-1">⚡ 性能優化 <a class="header-anchor" href="#⚡-性能優化" aria-label="Permalink to &quot;⚡ 性能優化&quot;">​</a></h2><ul><li>減少了不必要的狀態變更</li><li>移除了 onMounted 生命週期</li><li>直接在初始化時設置正確狀態</li></ul><h2 id="🛡️-兼容性" tabindex="-1">🛡️ 兼容性 <a class="header-anchor" href="#🛡️-兼容性" aria-label="Permalink to &quot;🛡️ 兼容性&quot;">​</a></h2><ul><li>加入了 SSR 檢查 <code>typeof window !== &#39;undefined&#39;</code></li><li>確保在服務端渲染環境中不會出錯</li><li>保持原有的輸入驗證邏輯</li></ul><p>現在用戶回到網頁時，會直接看到上次選擇的模式，沒有任何閃爍效果！🎉</p>`,25)]))}const g=s(h,[["render",t]]);export{E as __pageData,g as default};
